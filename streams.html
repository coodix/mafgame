<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>YouTube Live Streams - Параллельный просмотр</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
			background: #0f0f0f;
			color: #fff;
			overflow-x: hidden;
		}

		.container {
			min-height: 100vh;
			padding: 80px 20px 20px;
		}

		.meta {
			display: flex;
			gap: 15px;
			font-size: 12px;
			color: #aaa;
			margin-bottom: 15px;
		}

		.grid {
			display: grid;
			grid-template-columns: repeat(2, minmax(0, 1fr));
			gap: 14px;
			max-width: 1600px;
			margin: 0 auto;
		}

		.stream-wrapper {
			display: flex;
			flex-direction: column;
			background: #000;
			border-radius: 8px;
			overflow: hidden;
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
		}

		.stream-title {
			padding: 10px 15px;
			background: #1a1a1a;
			font-size: 14px;
			font-weight: 500;
			border-bottom: 1px solid #2a2a2a;
		}

		.stream-container {
			position: relative;
			width: 100%;
			padding-bottom: 56.25%;
			height: 0;
			overflow: hidden;
		}

		.stream-container iframe,
		.stream-container > div {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			border: none;
		}

		.controls {
			position: fixed;
			top: 20px;
			right: 20px;
			z-index: 1000;
			display: flex;
			flex-wrap: wrap;
			gap: 10px;
		}

		.btn {
			padding: 8px 16px;
			background: #ff0000;
			color: white;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			font-size: 12px;
			font-weight: 500;
			transition: background 0.2s;
		}

		.btn:hover {
			background: #cc0000;
		}

		.btn-primary {
			background: #00ff00;
			font-size: 14px;
			padding: 10px 20px;
		}

		.btn-primary:hover {
			background: #00cc00;
		}

		.status {
			position: fixed;
			top: 70px;
			right: 20px;
			z-index: 1000;
			background: rgba(0, 0, 0, 0.8);
			padding: 10px 15px;
			border-radius: 4px;
			font-size: 12px;
			display: none;
		}

		.empty-state {
			text-align: center;
			margin-top: 120px;
			color: #bbb;
		}

		@media (max-width: 1024px) {
			.grid {
				grid-template-columns: 1fr;
			}
		}
	</style>
</head>
<body>
	<div class="controls">
		<button class="btn btn-primary" onclick="playAllStreams()" id="playBtn">▶ Запустить все стримы</button>
		<button class="btn" onclick="toggleFullscreen(document.querySelector('.stream-wrapper'))">Полный экран активного</button>
	</div>
	<div class="status" id="status"></div>

	<div class="container">
		<div class="meta">
			<span>Всего стримов: <strong id="streamCount">2</strong></span>
			<span>Обновлено: 2025-11-29 09:48</span>
		</div>
		<div id="streamsContainer" class="grid"></div>
		<div class="empty-state" id="emptyState" style="display: none;">
			Прямые эфиры не найдены.
		</div>
	</div>

	<script>
		const streamData = [{"videoId":"h08xhk-GE3I","title":"Four Seasons: Call of Water. Winter - день 2, стол 2","description":"Four Seasons: Call of Water. Winter - день 2, стол 2 #mafgame #mafia #stream.","channelTitle":"MAFGAME","publishedAt":"2025-11-27T18:00:04Z","thumbnailUrl":"https://i.ytimg.com/vi/h08xhk-GE3I/default_live.jpg","viewCount":"15","url":"https://www.youtube.com/watch?v=h08xhk-GE3I"},{"videoId":"XN5WAqWutQU","title":"Four Seasons: Call of Water. Winter - день 2, стол 3","description":"Four Seasons: Call of Water. Winter - день 2, стол 3 #mafgame #mafia #stream #steam.","channelTitle":"MAFGAME","publishedAt":"2025-11-27T18:01:47Z","thumbnailUrl":"https://i.ytimg.com/vi/XN5WAqWutQU/default_live.jpg","viewCount":"16","url":"https://www.youtube.com/watch?v=XN5WAqWutQU"}];
		const players = [];
		let playersReady = 0;
		let allPlayersReady = false;
		const totalPlayers = streamData.length;
		const urlParams = new URLSearchParams(window.location.search);
		const autoPlayEnabled = urlParams.has('autoplay');

		document.addEventListener('DOMContentLoaded', initPage);

		function initPage() {
			if (!totalPlayers) {
				document.getElementById('emptyState').style.display = 'block';
				document.getElementById('playBtn').style.display = 'none';
				return;
			}

			const container = document.getElementById('streamsContainer');
			streamData.forEach((stream, index) => {
				const wrapper = document.createElement('div');
				wrapper.className = 'stream-wrapper';

				const title = document.createElement('div');
				title.className = 'stream-title';
				title.textContent = stream.channelTitle + ' — ' + stream.title;

				const streamContainer = document.createElement('div');
				streamContainer.className = 'stream-container';

				const playerHost = document.createElement('div');
				playerHost.id = 'player' + (index + 1);

				streamContainer.appendChild(playerHost);
				wrapper.appendChild(title);
				wrapper.appendChild(streamContainer);
				container.appendChild(wrapper);
			});
		}

		function onYouTubeIframeAPIReady() {
			if (!totalPlayers) {
				return;
			}
			showStatus('Инициализация проигрывателей...');

			streamData.forEach((stream, index) => {
				players[index] = new YT.Player('player' + (index + 1), {
					videoId: stream.videoId,
					playerVars: {
						'autoplay': autoPlayEnabled ? 1 : 0,
						'mute': 1,
						'controls': 1,
						'rel': 0,
						'modestbranding': 1,
						'playsinline': 1,
						'enablejsapi': 1,
						'origin': window.location.origin
					},
					events: {
						'onReady': onPlayerReady,
						'onStateChange': onPlayerStateChange
					}
				});
			});
		}

		function onPlayerReady() {
			playersReady++;
			showStatus('Готово проигрывателей: ' + playersReady + '/' + totalPlayers);

			if (playersReady === totalPlayers) {
				allPlayersReady = true;
				if (autoPlayEnabled) {
					showStatus('Все проигрыватели готовы!');
					setTimeout(tryAutoPlay, 1000);
				} else {
					showStatus('Проигрыватели готовы. Нажмите "Запустить все стримы"');
				}
			}
		}

		function tryAutoPlay() {
			if (!allPlayersReady || !autoPlayEnabled) {
				return;
			}

			let started = 0;
			let maxDelay = 0;

			players.forEach((player, index) => {
				const delay = Math.floor(Math.random() * 4000) + 1000;
				maxDelay = Math.max(maxDelay, delay);

				setTimeout(() => {
					try {
						if (player && typeof player.playVideo === 'function') {
							player.playVideo();
							started++;
							showStatus('Запускается стрим ' + (index + 1) + '... (' + started + '/' + totalPlayers + ')');
						}
					} catch (e) {
						console.log('Не удалось запустить стрим ' + (index + 1) + ':', e);
					}
				}, delay);
			});

			setTimeout(() => {
				if (started > 0) {
					showStatus('Запущено стримов: ' + started + '/' + totalPlayers);
					unmuteAll();
				} else {
					showStatus('Автозапуск заблокирован. Нажмите кнопку "Запустить все стримы"');
				}
			}, maxDelay + 2000);
		}

		function unmuteAll() {
			players.forEach((player, index) => {
				try {
					if (player && typeof player.unMute === 'function') {
						player.unMute();
					}
				} catch (e) {
					console.log('Не удалось включить звук на стриме ' + (index + 1) + ':', e);
				}
			});
			showStatus('Звук включен');
			setTimeout(hideStatus, 2000);
		}

		function playAllStreams() {
			if (!allPlayersReady) {
				showStatus('Проигрыватели еще не готовы. Подождите...');
				return;
			}

			showStatus('Запуск всех стримов...');

			let started = 0;
			let maxDelay = 0;

			players.forEach((player, index) => {
				const delay = Math.floor(Math.random() * 4000) + 1000;
				maxDelay = Math.max(maxDelay, delay);

				setTimeout(() => {
					try {
						if (player && typeof player.playVideo === 'function') {
							player.playVideo();
							started++;
							showStatus('Запускается стрим ' + (index + 1) + '... (' + started + '/' + totalPlayers + ')');
						}
					} catch (e) {
						console.log('Не удалось запустить стрим ' + (index + 1) + ':', e);
					}
				}, delay);
			});

			setTimeout(() => {
				if (started > 0) {
					showStatus('Запущено стримов: ' + started + '/' + totalPlayers);
					unmuteAll();
				}
			}, maxDelay + 2000);

			const playBtn = document.getElementById('playBtn');
			if (playBtn) {
				playBtn.style.display = 'none';
			}
		}

		function onPlayerStateChange(event) {
			if (event.data === YT.PlayerState.PLAYING) {
				console.log('Стрим воспроизводится');
			}
		}

		function showStatus(message) {
			const status = document.getElementById('status');
			if (status) {
				status.textContent = message;
				status.style.display = 'block';
			}
		}

		function hideStatus() {
			const status = document.getElementById('status');
			if (status) {
				status.style.display = 'none';
			}
		}

		let userInteracted = false;
		if (autoPlayEnabled) {
			document.addEventListener('click', () => {
				if (!userInteracted && allPlayersReady) {
					userInteracted = true;
					setTimeout(tryAutoPlay, 100);
				}
			}, { once: true });
		}

		function toggleFullscreen(element) {
			if (!element) {
				return;
			}

			if (!document.fullscreenElement) {
				element.requestFullscreen().catch(err => {
					alert('Ошибка при переходе в полноэкранный режим: ' + err.message);
				});
			} else {
				document.exitFullscreen();
			}
		}

		document.addEventListener('fullscreenchange', () => {
			if (!document.fullscreenElement) {
				showStatus('Полноэкранный режим выключен');
				setTimeout(hideStatus, 1500);
			}
		});
	</script>
	<script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>